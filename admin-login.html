<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://api.github.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data: https://cdn.jsdelivr.net; connect-src 'self' https://api.github.com https://api.netlify.com; frame-src 'none'; object-src 'none'; base-uri 'self'; form-action 'self';">
<title>Admin Giri≈üi - Bambinifojo</title>
<link rel="icon" type="image/svg+xml" href="favicon.svg"/>
<link rel="stylesheet" href="styles.css"/>
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    min-height: 100vh;
    background: #f5f7fa;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    position: relative;
    overflow: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
      linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    opacity: 0.05;
    pointer-events: none;
    z-index: 0;
  }

  body::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    z-index: 0;
  }

  .login-container,
  .card {
    position: relative;
    z-index: 1;
    background: #ffffff;
    border-radius: 12px;
    padding: 0 !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), 0 8px 24px rgba(0, 0, 0, 0.06);
    border: 1px solid #e5e7eb;
    max-width: 440px;
    width: 100%;
    animation: fadeInUp 0.4s ease;
    max-height: calc(100vh - 40px);
    overflow-y: auto;
    overflow-x: hidden;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .login-header-wrapper {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 40px 32px 32px;
    border-radius: 12px 12px 0 0;
    text-align: center;
    position: relative;
  }

  .login-header-wrapper::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: rgba(255, 255, 255, 0.2);
  }

  .login-header,
  .card-header {
    text-align: center;
    margin-bottom: 0 !important;
  }

  .login-header h1 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 8px;
    letter-spacing: -0.5px;
  }

  .login-header p {
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.875rem;
    font-weight: 400;
  }

  .login-icon {
    width: 56px;
    height: 56px;
    margin: 0 auto 20px;
    background: rgba(255, 255, 255, 0.2);
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid rgba(255, 255, 255, 0.3);
  }

  .login-icon svg {
    width: 28px;
    height: 28px;
    color: white;
  }

  .login-content {
    padding: 32px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 8px;
    color: #374151;
    font-weight: 500;
    font-size: 0.875rem;
    letter-spacing: 0.01em;
  }

  .form-group input {
    width: 100%;
    padding: 12px 16px;
    border: 1.5px solid #d1d5db;
    border-radius: 8px;
    font-size: 0.9375rem;
    transition: all 0.2s ease;
    box-sizing: border-box;
    background: #ffffff;
    font-family: inherit;
    color: #111827;
  }

  .form-group input::placeholder {
    color: #9ca3af;
  }

  .form-group input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .form-group input:hover:not(:focus) {
    border-color: #9ca3af;
  }

  .form-group input.error {
    border-color: #dc2626;
    box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
    animation: shake 0.5s;
  }

  .form-group input:disabled {
    background: #f3f4f6;
    cursor: not-allowed;
    opacity: 0.6;
  }

  .error-message {
    color: #dc2626;
    font-size: 0.8125rem;
    margin-top: 6px;
    display: block;
    min-height: 20px;
    line-height: 1.4;
  }

  .success-message {
    color: #059669;
    font-size: 0.8125rem;
    margin-top: 6px;
    display: block;
    min-height: 20px;
    line-height: 1.4;
  }

  /* Notification Toast */
  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    padding: 16px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 10000;
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 300px;
    max-width: 400px;
    animation: slideInRight 0.3s ease;
    border-left: 4px solid;
  }

  .notification.success {
    border-left-color: #10b981;
  }

  .notification.error {
    border-left-color: #ef4444;
  }

  .notification.warning {
    border-left-color: #f59e0b;
  }

  @keyframes slideInRight {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @keyframes slideOutRight {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }

  .notification.hiding {
    animation: slideOutRight 0.3s ease forwards;
  }

  .notification-icon {
    font-size: 1.2rem;
  }

  .notification-message {
    flex: 1;
    font-size: 0.875rem;
    color: #374151;
  }

  .notification-close {
    background: none;
    border: none;
    cursor: pointer;
    color: #9ca3af;
    font-size: 1.2rem;
    padding: 0;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.2s ease;
  }

  .notification-close:hover {
    color: #374151;
  }

  .btn-login,
  .btn {
    width: 100%;
    padding: 12px 0;
    height: 44px !important;
    border: none;
    border-radius: 8px;
    font-size: 0.9375rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
    font-family: inherit;
    margin-top: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    letter-spacing: 0.01em;
  }

  .btn-login:hover {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
    transform: translateY(-1px);
  }

  .btn-login:active {
    transform: translateY(0);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
  }

  .btn-login:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
  }

  .back-link {
    display: block;
    text-align: center;
    margin-top: 24px;
    color: #6b7280;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.875rem;
    transition: all 0.2s ease;
    padding: 8px;
    border-radius: 6px;
  }

  .back-link:hover {
    color: #667eea;
    background: #f9fafb;
  }

  .password-toggle {
    position: relative;
  }

  .password-toggle-btn {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    color: #666;
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.3s ease;
  }

  .password-toggle-btn:hover {
    color: #667eea;
  }

  .password-toggle input {
    padding-right: 45px;
  }

  /* Accordion Yapƒ±sƒ± */
  .accordion {
    width: 100%;
    max-width: 100%;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .ac-item {
    width: 100%;
  }

  /* Accordion Ba≈ülƒ±k */
  .ac-header {
    width: 100%;
    padding: 14px 16px;
    background: #f9fafb;
    border-radius: 8px;
    font-size: 0.9375rem;
    text-align: left;
    border: 1px solid #e5e7eb;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s ease;
    color: #374151;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .ac-header::after {
    content: '+';
    font-size: 20px;
    font-weight: 300;
    color: #6b7280;
    transition: transform 0.2s ease;
    line-height: 1;
  }

  .ac-item.active .ac-header::after {
    transform: rotate(45deg);
    color: #667eea;
  }

  .ac-header:hover {
    background: #f3f4f6;
    border-color: #d1d5db;
  }

  .ac-item.active .ac-header {
    background: #f0f4ff;
    border-color: #667eea;
    color: #667eea;
  }

  /* Accordion ƒ∞√ßerik */
  .ac-body {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), padding 0.4s ease, border-color 0.3s ease;
    background: #ffffff;
    border-radius: 8px;
    padding: 0 16px;
    margin-top: 8px;
    border: 1px solid #e5e7eb;
    opacity: 0;
  }

  .ac-body.open {
    padding: 20px 16px;
    max-height: 2000px;
    border-color: #d1d5db;
    opacity: 1;
  }

  /* Accordion i√ßeriƒüi i√ßin smooth transition */
  .ac-body > * {
    opacity: 0;
    transition: opacity 0.3s ease 0.1s;
  }

  .ac-body.open > * {
    opacity: 1;
  }

  .setup-section {
    padding: 0;
  }

  .setup-content h2 {
    font-size: 1.3rem;
    margin-bottom: 12px;
    color: #333;
  }

  .form-group-setup {
    margin-top: 20px;
  }

  .code-input {
    text-align: center;
    font-size: 1.5rem;
    letter-spacing: 8px;
    font-weight: 600;
    height: 45px !important;
  }

  .code-input-sm {
    font-size: 1.2rem;
    letter-spacing: 5px;
  }

  .btn-auto-fill {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 8px;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: white;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
  }

  .btn-auto-fill:hover {
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }

  .btn-auto-fill:active {
    transform: translateY(-50%) scale(0.95);
  }

  .btn-auto-fill svg {
    width: 18px;
    height: 18px;
  }

  #twoFactorGroup {
    position: relative;
  }

  .code-input-wrapper {
    position: relative;
  }

  #twoFactorGroup .code-input {
    padding-right: 55px;
  }

  .code-hint {
    display: block;
    margin-top: 8px;
    color: #667eea;
    cursor: pointer;
    font-weight: 500;
    font-size: 0.9rem;
  }

  .code-hint-desc {
    display: block;
    margin-top: 6px;
    font-size: 0.85rem;
    color: #666;
  }

  .setup-description {
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: 20px;
  }

  .setup-description strong {
    color: #667eea;
    font-weight: 600;
  }

  .qr-container {
    background: white;
    padding: 12px;
    border-radius: 10px;
    display: inline-block;
    margin: 12px 0;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    max-width: 100%;
    width: 100%;
    text-align: center;
  }

  .qr-code-wrapper {
    min-height: 160px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    width: 100%;
  }

  .qr-canvas {
    display: block !important;
    margin: 0 auto !important;
    width: 140px !important;
    height: 140px !important;
    border: 3px solid #f0f0f0 !important;
    border-radius: 10px !important;
    padding: 8px !important;
    background: white !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
    transition: all 0.3s ease !important;
    animation: qrPulse 2s ease-in-out infinite !important;
  }

  .qr-container canvas.qr-canvas:hover,
  .qr-container img.qr-canvas:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
    border-color: #667eea;
  }

  .qr-error {
    color: #ff4444;
    padding: 20px;
    text-align: center;
  }

  .qr-error p {
    margin: 5px 0;
  }

  .qr-error p:first-child {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 10px;
  }

  .qr-error p:last-child {
    font-size: 0.9rem;
  }

  .qr-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 15px;
    color: #666;
  }

  .spinner-qr {
    width: 40px;
    height: 40px;
    border: 4px solid #f0f0f0;
    border-top-color: #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  .qr-instructions,
  .howto.compact {
    margin-top: 12px;
    text-align: left;
    background: #f9f9f9;
    padding: 8px 12px !important;
    border-radius: 8px;
    border-left: 3px solid #667eea;
  }

  .qr-instructions p,
  .howto.compact p {
    margin: 0 0 8px 0;
    color: #333;
    font-weight: 600;
    font-size: 0.875rem;
  }

  .qr-instructions ol,
  .howto.compact ol {
    margin: 0;
    padding-left: 18px;
    color: #666;
    line-height: 1.45;
    font-size: 0.85rem;
  }

  .qr-instructions li,
  .howto.compact li {
    margin-bottom: 3px;
  }

  .qr-instructions strong {
    color: #667eea;
  }

  .manual-key {
    background: #f9f9f9;
    padding: 12px;
    border-radius: 8px;
    margin: 12px 0;
    border: 1px solid #e0e0e0;
  }

  .manual-key p {
    margin: 0 0 8px 0;
    font-size: 0.875rem;
    color: #333;
    font-weight: 600;
  }

  .key-row {
    display: flex;
    gap: 6px;
    align-items: center;
  }

  .key-row input {
    flex: 1;
    background: white;
    padding: 10px 12px;
    border-radius: 6px;
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    word-break: break-all;
    color: #333;
    border: 1px solid #ddd;
  }

  .secret-key {
    display: block;
    background: white;
    padding: 10px 12px;
    border-radius: 6px;
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    word-break: break-all;
    color: #333;
    border: 1px solid #ddd;
    margin-bottom: 0;
  }

  .btn-copy,
  .copy-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 10px 14px;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 6px rgba(102, 126, 234, 0.25);
    min-width: 50px;
    height: 42px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .btn-copy:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }

  .btn-copy:active {
    transform: translateY(0);
  }

  .button-group-setup {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 20px;
  }

  .btn-secondary-setup {
    background: #ffffff;
    color: #667eea;
    border: 1.5px solid #d1d5db;
    padding: 12px 0;
    height: 44px !important;
    border-radius: 8px;
    font-size: 0.9375rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    width: 100%;
    font-family: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
    letter-spacing: 0.01em;
  }

  .btn-secondary-setup:hover {
    background: #f9fafb;
    border-color: #667eea;
    color: #667eea;
  }

  .btn-secondary-setup:active {
    transform: translateY(0);
  }

  .success-btn {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
  }

  .success-btn:hover {
    background: linear-gradient(135deg, #059669 0%, #047857 100%) !important;
  }

  .login-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  }

  .login-btn:hover {
    background: linear-gradient(135deg, #5568d3 0%, #6a3d8f 100%) !important;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  @keyframes qrPulse {
    0%, 100% { box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
    50% { box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3); }
  }

  @media (max-width: 768px) {
    body {
      padding: 10px;
      overflow-x: hidden;
    }

    .login-container {
      max-width: 100%;
      border-radius: 12px;
      max-height: calc(100vh - 20px);
    }

    .login-header-wrapper {
      padding: 32px 24px 24px;
    }

    .login-content {
      padding: 24px;
    }

    .login-header {
      margin-bottom: 0;
    }

    .login-header h1 {
      font-size: 1.3rem;
      margin-bottom: 6px;
    }

    .login-header p {
      font-size: 0.8rem;
    }

    .login-icon {
      width: 48px;
      height: 48px;
      margin-bottom: 16px;
    }

    .login-icon svg {
      width: 24px;
      height: 24px;
    }

    .ac-header {
      padding: 10px 12px;
      font-size: 0.85rem;
    }

    .ac-body {
      padding: 0 12px;
    }

    .ac-body.open {
      padding: 16px 12px;
    }

    .setup-description {
      font-size: 0.75rem;
      margin-bottom: 10px;
      line-height: 1.5;
    }

    .qr-container {
      padding: 8px;
      margin: 6px 0;
    }

    .qr-code-wrapper {
      min-height: 140px;
    }

    .qr-canvas {
      max-width: 80% !important;
      width: 120px !important;
      height: 120px !important;
      padding: 6px !important;
    }

    .qr-instructions {
      padding: 10px;
      margin-top: 10px;
    }

    .qr-instructions p {
      font-size: 0.8rem;
      margin-bottom: 8px;
    }

    .qr-instructions ol {
      font-size: 0.8rem;
      line-height: 1.4;
      padding-left: 16px;
    }

    .qr-instructions li {
      margin-bottom: 3px;
    }

    .manual-key {
      padding: 10px;
      margin: 10px 0;
    }

    .manual-key p {
      font-size: 0.8rem;
      margin-bottom: 6px;
    }

    .secret-key {
      font-size: 0.75rem;
      padding: 6px 8px;
      word-break: break-all;
    }

    .btn-copy {
      padding: 8px 12px;
      font-size: 0.8rem;
    }

    .form-group {
      margin-bottom: 12px;
    }

    .form-group label {
      font-size: 0.8rem;
      margin-bottom: 5px;
    }

    .form-group input {
      padding: 10px 12px;
      font-size: 0.9rem;
    }

    .form-group-setup {
      margin-top: 14px;
    }

    .code-input {
      font-size: 1rem;
      letter-spacing: 3px;
      padding: 8px;
      height: 40px !important;
    }

    .code-hint {
      font-size: 0.8rem;
    }

    .code-hint-desc {
      font-size: 0.75rem;
    }

    .button-group-setup {
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }

    .btn-login,
    .btn-secondary-setup {
      width: 100%;
      padding: 10px;
      font-size: 0.85rem;
      height: 38px !important;
    }

    .back-link {
      margin-top: 14px;
      font-size: 0.8rem;
    }
  }

  @media (max-width: 480px) {
    body {
      padding: 8px;
      overflow-x: hidden;
    }

    .login-container {
      max-width: 100%;
      max-height: calc(100vh - 16px);
      border-radius: 12px;
    }

    .login-header-wrapper {
      padding: 28px 20px 20px;
    }

    .login-content {
      padding: 20px;
    }

    .login-header h1 {
      font-size: 1.2rem;
      margin-bottom: 6px;
    }

    .login-header p {
      font-size: 0.75rem;
    }

    .login-icon {
      width: 44px;
      height: 44px;
      margin-bottom: 14px;
    }

    .login-icon svg {
      width: 20px;
      height: 20px;
    }

    .ac-header {
      padding: 8px 10px;
      font-size: 0.8rem;
    }

    .ac-body {
      padding: 0 10px;
    }

    .ac-body.open {
      padding: 14px 10px;
    }

    .form-group {
      margin-bottom: 10px;
    }

    .form-group label {
      font-size: 0.75rem;
      margin-bottom: 4px;
    }

    .form-group input {
      padding: 8px 10px;
      font-size: 0.85rem;
    }

    .btn-login,
    .btn-secondary-setup {
      padding: 9px;
      font-size: 0.8rem;
      height: 36px !important;
    }

    .qr-code-wrapper {
      min-height: 140px;
    }

    .code-input {
      font-size: 0.95rem;
      letter-spacing: 2px;
      height: 38px !important;
    }

    .qr-canvas {
      width: 100px !important;
      height: 100px !important;
    }

    .qr-code-wrapper {
      min-height: 120px;
    }
  }
</style>
</head>
<body>
  <script>
    // Sayfa y√ºklenme kontrol√º
    console.log('‚úÖ Admin login sayfasƒ± y√ºkleniyor...');
    
    // Global error handler
    window.addEventListener('error', (e) => {
      console.error('‚ùå Sayfa hatasƒ±:', e.error);
      console.error('Hata mesajƒ±:', e.message);
      console.error('Dosya:', e.filename);
      console.error('Satƒ±r:', e.lineno);
      console.error('S√ºtun:', e.colno);
    });

    // Unhandled promise rejection handler
    window.addEventListener('unhandledrejection', (e) => {
      console.error('‚ùå Promise hatasƒ±:', e.reason);
    });

    // Sayfa g√∂r√ºn√ºrl√ºƒü√º kontrol√º
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') {
        console.log('‚úÖ Sayfa g√∂r√ºn√ºr');
      }
    });
  </script>
  <div class="login-container">
    <div class="login-header-wrapper">
      <div class="login-header">
        <div class="login-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
        </div>
        <h1>Admin Giri≈üi</h1>
        <p>Y√∂netim paneline eri≈ümek i√ßin ≈üifrenizi girin</p>
      </div>
    </div>

    <div class="login-content">
      <!-- Accordion Yapƒ±sƒ± -->
      <div class="accordion" id="mainAccordion">
      
      <!-- 1. B√∂l√ºm ‚Äì Google Authenticator Kurulumu -->
      <div class="ac-item" id="setupAccordion">
        <button class="ac-header" type="button">üì≤ Google Auth Kurulumu</button>
        <div class="ac-body" id="setupBody">
          <p class="setup-description">G√ºvenliƒüiniz i√ßin telefonunuza <strong>Google Authenticator</strong> veya benzeri bir uygulama indirin ve a≈üaƒüƒ±daki QR kodu telefonunuzla tarayƒ±n.</p>
          
          <div class="qr-container">
            <div id="qrcode" class="qr-code-wrapper">
              <div class="qr-loading">
                <div class="spinner-qr"></div>
                <p>QR kod olu≈üturuluyor...</p>
              </div>
            </div>
          </div>
          
          <div class="howto compact">
            <ol>
              <li>Google Authenticator'ƒ± a√ßƒ±n</li>
              <li>"+" ‚Üí "QR Kod Tara" deyin</li>
              <li>Bu QR kodu okutun</li>
              <li>Kod eklendi ‚úî</li>
            </ol>
          </div>
          
          <div class="manual-key">
            <p><strong>Manuel Anahtar:</strong></p>
            <div class="key-row">
              <input type="text" id="secretKey" class="secret-key" readonly aria-label="Manuel anahtar">
              <button type="button" class="copy-btn" onclick="copySecret()" title="Kopyala">üìã</button>
            </div>
          </div>
          
          <div class="form-group form-group-setup">
            <label for="verifyCode">Doƒürulama Kodu (6 haneli)</label>
            <input 
              type="text" 
              id="verifyCode" 
              name="verifyCode" 
              class="code-input"
              placeholder="000000" 
              maxlength="6"
              pattern="[0-9]{6}"
            />
            <small id="setupCodeHint" class="code-hint"></small>
            <small class="code-hint-desc">Telefonunuzdaki uygulamadan 6 haneli kodu girin veya yukarƒ±daki ipucuna tƒ±klayarak otomatik doldurun</small>
          </div>
          
          <div class="button-group-setup">
            <button type="button" class="btn-login success-btn" onclick="verifySetup()">
              <span>‚úÖ Doƒürula ve Kaydet</span>
            </button>
            <button type="button" class="btn-secondary-setup" onclick="skipSetup()">
              <span>‚è≠Ô∏è ≈ûimdilik Atla</span>
            </button>
          </div>
        </div>
      </div>

      <!-- 2. B√∂l√ºm ‚Äì Admin Giri≈ü -->
      <div class="ac-item" id="loginAccordion">
        <button class="ac-header" type="button">üîë Admin Giri≈ü</button>
        <div class="ac-body" id="loginBody">
          <form id="loginForm" onsubmit="handleLogin(event)">
            <div class="form-group">
              <label for="password">≈ûifre</label>
              <div class="password-toggle">
                <input 
                  type="password" 
                  id="password" 
                  name="password" 
                  placeholder="≈ûifrenizi girin" 
                  required 
                  autocomplete="current-password"
                />
                <button type="button" class="password-toggle-btn" onclick="togglePassword()" aria-label="≈ûifreyi g√∂ster/gizle">
                  <svg id="eyeIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
              </div>
              <span class="error-message" id="errorMessage"></span>
            </div>

            <!-- 2FA Kodu (Eƒüer kurulum yapƒ±ldƒ±ysa) -->
            <div class="form-group hidden" id="twoFactorGroup">
              <label for="twoFactorCode">üì± Telefon Doƒürulama Kodu</label>
              <div class="code-input-wrapper">
                <input 
                  type="text" 
                  id="twoFactorCode" 
                  name="twoFactorCode" 
                  class="code-input code-input-sm"
                  placeholder="000000" 
                  maxlength="6"
                  pattern="[0-9]{6}"
                  autocomplete="one-time-code"
                />
                <button type="button" class="btn-auto-fill" onclick="autoFillCode()" title="Otomatik Doldur">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7"></path>
                    <line x1="18" y1="3" x2="18" y2="9"></line>
                    <line x1="15" y1="6" x2="21" y2="6"></line>
                  </svg>
                </button>
              </div>
              <small id="autoCodeDisplay" class="code-hint"></small>
              <small class="code-hint-desc">Telefonunuzdaki Google Authenticator uygulamasƒ±ndan 6 haneli kodu girin veya otomatik doldur butonuna tƒ±klayƒ±n</small>
              <span class="error-message" id="twoFactorError"></span>
            </div>

            <button type="submit" class="btn-login login-btn" id="loginBtn" aria-label="Giri≈ü yap">
              <span id="loginBtnText">üîì Giri≈ü Yap</span>
            </button>
          </form>
        </div>
      </div>

      </div>

      <a href="/" class="back-link">‚Üê Ana Sayfaya D√∂n</a>
    </div>
  </div>

  <!-- QR Code Library - %100 √áALI≈ûAN √á√ñZ√úM -->
  <script>
    // Tracking Prevention uyarƒ±larƒ±nƒ± gizle (zararsƒ±z uyarƒ±lar)
    const originalWarn = console.warn;
    const originalError = console.error;
    
    console.warn = function(...args) {
      const message = args[0];
      if (message && typeof message === 'string' && 
          (message.includes('Tracking Prevention') || 
           message.includes('blocked access to storage'))) {
        return; // Bu uyarƒ±larƒ± gizle
      }
      originalWarn.apply(console, args);
    };
    
    console.error = function(...args) {
      const message = args[0];
      if (message && typeof message === 'string' && 
          (message.includes('Tracking Prevention') || 
           message.includes('blocked access to storage'))) {
        return; // Bu hatalarƒ± gizle
      }
      originalError.apply(console, args);
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js" onerror="console.error('‚ùå QRCode CDN y√ºklenemedi!')"></script>
  <script>
    // QRCode k√ºt√ºphanesinin y√ºklendiƒüini kontrol et
    (function checkQRCode() {
      if (typeof QRCode !== "undefined") {
        console.log("‚úÖ QRCode y√ºklendi!");
        window.qrcodeLoaded = true;
        return;
      }
      
      // Kƒ±sa bir gecikme ile tekrar kontrol et
      setTimeout(() => {
        if (typeof QRCode !== "undefined") {
          console.log("‚úÖ QRCode y√ºklendi! (gecikmeli)");
          window.qrcodeLoaded = true;
          return;
        }
        
        console.warn("‚ö†Ô∏è QRCode k√ºt√ºphanesi y√ºklenemedi! Alternatif CDN deneniyor...");
        // Alternatif CDN
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js';
        script.onload = function() {
          console.log("‚úÖ Alternatif QRCode CDN y√ºklendi!");
          window.qrcodeLoaded = true;
        };
        script.onerror = function() {
          console.error("‚ùå Alternatif QRCode CDN de y√ºklenemedi!");
          window.qrcodeLoaded = false;
        };
        document.head.appendChild(script);
      }, 500);
    })();
  </script>
  
  <script>
    // TOTP (Time-based One-Time Password) Fonksiyonlarƒ±
    // Base32 decode
    function base32Decode(str) {
      const base32chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
      let bits = 0;
      let value = 0;
      let index = 0;
      const output = new Uint8Array(((str.length * 5) / 8) | 0);
      
      for (let i = 0; i < str.length; i++) {
        value = (value << 5) | base32chars.indexOf(str[i].toUpperCase());
        bits += 5;
        if (bits >= 8) {
          output[index++] = (value >>> (bits - 8)) & 255;
          bits -= 8;
        }
      }
      return output;
    }

    // HMAC-SHA1
    async function hmacSha1(key, message) {
      const cryptoKey = await crypto.subtle.importKey(
        'raw',
        key,
        { name: 'HMAC', hash: 'SHA-1' },
        false,
        ['sign']
      );
      const signature = await crypto.subtle.sign('HMAC', cryptoKey, message);
      return new Uint8Array(signature);
    }

    // TOTP kod √ºret
    async function generateTOTP(secret, timeStep = 30) {
      const time = Math.floor(Date.now() / 1000 / timeStep);
      const timeBuffer = new ArrayBuffer(8);
      const timeView = new DataView(timeBuffer);
      timeView.setUint32(4, time, false);
      
      const key = base32Decode(secret);
      const hmac = await hmacSha1(key, timeBuffer);
      
      const offset = hmac[hmac.length - 1] & 0x0f;
      const code = ((hmac[offset] & 0x7f) << 24) |
                   ((hmac[offset + 1] & 0xff) << 16) |
                   ((hmac[offset + 2] & 0xff) << 8) |
                   (hmac[offset + 3] & 0xff);
      
      return (code % 1000000).toString().padStart(6, '0');
    }

    // TOTP doƒürula (30 saniye tolerans)
    async function verifyTOTP(secret, code) {
      const currentCode = await generateTOTP(secret);
      if (currentCode === code) return true;
      
      // √ñnceki ve sonraki zaman dilimlerini de kontrol et
      const time = Math.floor(Date.now() / 1000 / 30);
      for (let i = -1; i <= 1; i++) {
        const testTime = time + i;
        const timeBuffer = new ArrayBuffer(8);
        const timeView = new DataView(timeBuffer);
        timeView.setUint32(4, testTime, false);
        
        const key = base32Decode(secret);
        const hmac = await hmacSha1(key, timeBuffer);
        
        const offset = hmac[hmac.length - 1] & 0x0f;
        const testCode = ((hmac[offset] & 0x7f) << 24) |
                         ((hmac[offset + 1] & 0xff) << 16) |
                         ((hmac[offset + 2] & 0xff) << 8) |
                         (hmac[offset + 3] & 0xff);
        const testCodeStr = (testCode % 1000000).toString().padStart(6, '0');
        if (testCodeStr === code) return true;
      }
      return false;
    }

    // Rastgele secret key √ºret
    function generateSecret() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
      let secret = '';
      for (let i = 0; i < 16; i++) {
        secret += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return secret;
    }

    // Basit hash fonksiyonu (SHA-256)
    async function hashPassword(password) {
      const encoder = new TextEncoder();
      const data = encoder.encode(password);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      return hashHex;
    }

    // ≈ûifre kontrol√º (varsayƒ±lan ≈üifre: "admin123" - hash'lenmi≈ü hali)
    const ADMIN_PASSWORD_HASH = '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9'; // "admin123"
    
    // 2FA Secret Key (localStorage'da saklanƒ±r, ilk kurulumda olu≈üturulur)
    let twoFactorSecret = localStorage.getItem('admin2FASecret');
    let twoFactorEnabled = localStorage.getItem('admin2FAEnabled') === 'true';

    // Rate limiting (Brute force korumasƒ±)
    const MAX_LOGIN_ATTEMPTS = 5;
    const LOCKOUT_DURATION = 15 * 60 * 1000; // 15 dakika
    const ATTEMPT_RESET_TIME = 60 * 1000; // 1 dakika

    function getLoginAttempts() {
      const attempts = localStorage.getItem('loginAttempts');
      return attempts ? JSON.parse(attempts) : { count: 0, lastAttempt: 0, lockoutUntil: 0 };
    }

    function setLoginAttempts(attempts) {
      localStorage.setItem('loginAttempts', JSON.stringify(attempts));
    }

    function resetLoginAttempts() {
      localStorage.removeItem('loginAttempts');
    }

    function checkLoginLockout() {
      const attempts = getLoginAttempts();
      const now = Date.now();

      // Lockout s√ºresi dolmu≈ü mu kontrol et
      if (attempts.lockoutUntil > 0 && now < attempts.lockoutUntil) {
        const remainingMinutes = Math.ceil((attempts.lockoutUntil - now) / 60000);
        return {
          locked: true,
          message: `√áok fazla ba≈üarƒ±sƒ±z giri≈ü denemesi. L√ºtfen ${remainingMinutes} dakika sonra tekrar deneyin.`
        };
      }

      // Lockout s√ºresi dolmu≈üsa sƒ±fƒ±rla
      if (attempts.lockoutUntil > 0 && now >= attempts.lockoutUntil) {
        resetLoginAttempts();
        return { locked: false };
      }

      // 1 dakika ge√ßmi≈üse sayacƒ± sƒ±fƒ±rla
      if (now - attempts.lastAttempt > ATTEMPT_RESET_TIME) {
        resetLoginAttempts();
        return { locked: false };
      }

      return { locked: false, attempts: attempts.count };
    }

    function recordFailedLogin() {
      const attempts = getLoginAttempts();
      const now = Date.now();
      
      attempts.count += 1;
      attempts.lastAttempt = now;

      if (attempts.count >= MAX_LOGIN_ATTEMPTS) {
        attempts.lockoutUntil = now + LOCKOUT_DURATION;
        setLoginAttempts(attempts);
        return {
          locked: true,
          message: `√áok fazla ba≈üarƒ±sƒ±z giri≈ü denemesi. Hesabƒ±nƒ±z 15 dakika s√ºreyle kilitlendi.`
        };
      }

      setLoginAttempts(attempts);
      return {
        locked: false,
        remaining: MAX_LOGIN_ATTEMPTS - attempts.count
      };
    }

    // QRCode k√ºt√ºphanesinin y√ºklendiƒüini kontrol et
    let qrCodeCheckAttempts = 0;
    const MAX_QRCODE_CHECK_ATTEMPTS = 50; // 5 saniye (50 * 100ms)
    
    function waitForQRCode(callback) {
      qrCodeCheckAttempts++;
      
      // QRCode'un y√ºklenip y√ºklenmediƒüini kontrol et
      const qrCodeAvailable = typeof QRCode !== 'undefined' || 
                              typeof window.QRCode !== 'undefined' ||
                              window.qrcodeLoaded === true;
      
      if (qrCodeAvailable) {
        console.log('‚úÖ QRCode k√ºt√ºphanesi y√ºklendi');
        qrCodeCheckAttempts = 0;
        if (typeof callback === 'function') {
          callback();
        }
      } else if (qrCodeCheckAttempts >= MAX_QRCODE_CHECK_ATTEMPTS) {
        console.warn('‚ö†Ô∏è QRCode k√ºt√ºphanesi y√ºklenemedi! Maksimum deneme sayƒ±sƒ±na ula≈üƒ±ldƒ±. Manuel anahtar kullanƒ±labilir.');
        showQRCodeError();
        // Yine de callback'i √ßaƒüƒ±r (manuel anahtar kullanƒ±labilir)
        qrCodeCheckAttempts = 0;
        if (typeof callback === 'function') {
          callback();
        }
      } else {
        setTimeout(() => waitForQRCode(callback), 100);
      }
    }
    
    function showQRCodeError() {
      const qrContainer = document.getElementById('qrcode');
      if (qrContainer) {
        qrContainer.innerHTML = `
          <div class="qr-error">
            <p>‚ö†Ô∏è QR kod k√ºt√ºphanesi y√ºklenemedi</p>
            <p>Manuel anahtarƒ± kullanarak ekleyebilirsiniz</p>
            <button onclick="location.reload()" style="margin-top: 10px; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">Sayfayƒ± Yenile</button>
          </div>
        `;
      }
    }
    

    // Sayfa y√ºklendiƒüinde kontrol et
    window.addEventListener('DOMContentLoaded', () => {
      console.log('‚úÖ DOMContentLoaded tetiklendi');
      
      // URL parametrelerinden ≈üifre ve 2FA kodunu al ve form alanlarƒ±na doldur
      const urlParams = new URLSearchParams(window.location.search);
      const urlPassword = urlParams.get('password');
      const urlTwoFactorCode = urlParams.get('twoFactorCode');
      
      if (urlPassword) {
        const passwordInput = document.getElementById('password');
        if (passwordInput) {
          passwordInput.value = urlPassword;
          console.log('üîó URL\'den ≈üifre form alanƒ±na dolduruldu');
        }
      }
      
      if (urlTwoFactorCode) {
        const twoFactorInput = document.getElementById('twoFactorCode');
        if (twoFactorInput) {
          twoFactorInput.value = urlTwoFactorCode;
          console.log('üîó URL\'den 2FA kodu form alanƒ±na dolduruldu');
        }
      }
      
      try {
        // Accordion'ƒ± ba≈ülat
        console.log('üîç initAccordion fonksiyonu kontrol ediliyor...');
        if (typeof initAccordion === 'function') {
          console.log('‚úÖ initAccordion √ßaƒürƒ±lƒ±yor...');
          initAccordion();
        } else {
          console.error('‚ùå initAccordion fonksiyonu bulunamadƒ±!');
        }
        
        console.log('üîç waitForQRCode √ßaƒürƒ±lƒ±yor...');
        waitForQRCode(() => {
          console.log('‚úÖ QR kod callback √ßaƒürƒ±ldƒ±');
          try {
            // 2FA kurulumu yapƒ±lmƒ±≈ü mƒ± kontrol et
            console.log('üîç 2FA durumu kontrol ediliyor...', { twoFactorSecret: !!twoFactorSecret, twoFactorEnabled });
            if (!twoFactorSecret || !twoFactorEnabled) {
              // ƒ∞lk kurulum
              console.log('üì± ƒ∞lk kurulum modu');
              if (typeof showSetup === 'function') {
                console.log('‚úÖ showSetup √ßaƒürƒ±lƒ±yor...');
                showSetup();
              } else {
                console.error('‚ùå showSetup fonksiyonu bulunamadƒ±!');
              }
            } else {
              // Normal giri≈ü, 2FA aktif
              console.log('üîê Normal giri≈ü modu (2FA aktif)');
              if (typeof showLogin === 'function') {
                console.log('‚úÖ showLogin √ßaƒürƒ±lƒ±yor...');
                showLogin();
              } else {
                console.error('‚ùå showLogin fonksiyonu bulunamadƒ±!');
              }
              const twoFactorGroup = document.getElementById('twoFactorGroup');
              if (twoFactorGroup) {
                twoFactorGroup.classList.remove('hidden');
              }
              // 2FA kodunu otomatik √ºret ve g√∂ster
              if (typeof startAutoGenerateCode === 'function') {
                startAutoGenerateCode();
              }
            }
          } catch (error) {
            console.error('‚ùå QR kod callback hatasƒ±:', error);
            console.error('Stack:', error.stack);
          }
        });
      } catch (error) {
        console.error('‚ùå DOMContentLoaded hatasƒ±:', error);
        console.error('Stack:', error.stack);
      }
    });

    // Sayfa y√ºklendiƒüinde ek kontrol
    if (document.readyState === 'loading') {
      console.log('‚è≥ Sayfa y√ºkleniyor...');
    } else {
      console.log('‚úÖ Sayfa zaten y√ºkl√º');
      // Eƒüer sayfa zaten y√ºkl√ºyse, DOMContentLoaded tetiklenmeyebilir
      setTimeout(() => {
        try {
          if (typeof initAccordion === 'function') {
            initAccordion();
          }
          // 2FA durumunu kontrol et ve uygun accordion'ƒ± a√ß
          if (!twoFactorSecret || !twoFactorEnabled) {
            if (typeof showSetup === 'function') {
              showSetup();
            }
          } else {
            if (typeof showLogin === 'function') {
              showLogin();
            }
          }
        } catch (error) {
          console.error('‚ùå Sayfa y√ºkleme hatasƒ±:', error);
        }
      }, 100);
    }

    // 2FA kodunu otomatik √ºret ve g√∂ster
    async function startAutoGenerateCode() {
      if (!twoFactorSecret || !twoFactorEnabled) return;
      
      const twoFactorInput = document.getElementById('twoFactorCode');
      if (!twoFactorInput) return;

      // ƒ∞lk kodu hemen √ºret
      updateAutoCode();
      
      // Her 30 saniyede bir g√ºncelle
      setInterval(() => {
        updateAutoCode();
      }, 30000);
    }

    // Otomatik kodu g√ºncelle
    async function updateAutoCode() {
      if (!twoFactorSecret) return;
      
      try {
        const code = await generateTOTP(twoFactorSecret);
        const twoFactorInput = document.getElementById('twoFactorCode');
        const codeDisplay = document.getElementById('autoCodeDisplay');
        
        if (twoFactorInput && codeDisplay) {
          // Sadece g√∂ster, otomatik doldurma (kullanƒ±cƒ± manuel girebilir)
          codeDisplay.textContent = `G√ºncel kod: ${code}`;
        }
      } catch (error) {
        console.error('Kod √ºretme hatasƒ±:', error);
      }
    }

    // Setup g√∂ster
    function showSetup() {
      console.log('üîç [DEBUG] showSetup() √ßaƒürƒ±ldƒ±');
      
      // Setup accordion'ƒ± a√ß
      const setupAccordion = document.getElementById('setupAccordion');
      const setupBody = document.getElementById('setupBody');
      const setupHeader = setupAccordion?.querySelector('.ac-header');
      console.log('üîç [DEBUG] Setup Accordion:', setupAccordion);
      console.log('üîç [DEBUG] Setup Body:', setupBody);
      
      if (setupAccordion && setupBody) {
        const setupHeader = setupAccordion.querySelector('.ac-header');
        openAccordionItem(setupAccordion, setupBody, setupHeader);
        console.log('‚úÖ [DEBUG] Setup accordion a√ßƒ±ldƒ±');
        
        // Accordion a√ßƒ±ldƒ±ƒüƒ±nda smooth scroll yap
        setTimeout(() => {
          if (setupHeader) {
            const headerRect = setupHeader.getBoundingClientRect();
            const headerTop = headerRect.top + window.pageYOffset;
            const offset = 30; // √ústten bo≈üluk
            
            window.scrollTo({
              top: Math.max(0, headerTop - offset),
              behavior: 'smooth'
            });
          }
        }, 200);
      } else {
        console.error('‚ùå [DEBUG] Setup accordion elementleri bulunamadƒ±!');
      }
      
      // Login accordion'ƒ± kapat
      const loginAccordion = document.getElementById('loginAccordion');
      const loginBody = document.getElementById('loginBody');
      if (loginAccordion && loginBody && loginBody.classList.contains('open')) {
        closeAccordionItem(loginAccordion, loginBody);
      }
      
      // Yeni secret olu≈ütur
      if (!twoFactorSecret) {
        twoFactorSecret = generateSecret();
        console.log('‚úÖ [DEBUG] Yeni secret olu≈üturuldu:', twoFactorSecret);
      } else {
        console.log('üîç [DEBUG] Mevcut secret kullanƒ±lƒ±yor:', twoFactorSecret);
      }
      
      // QR kod otomatik olu≈ütur
      console.log('üîç [DEBUG] generateQRCode() √ßaƒürƒ±lƒ±yor...');
      generateQRCode();
      
      // Secret key g√∂ster
      const secretKeyElement = document.getElementById('secretKey');
      if (secretKeyElement) {
        secretKeyElement.value = twoFactorSecret;
        console.log('‚úÖ [DEBUG] Secret key g√∂sterildi');
      } else {
        console.error('‚ùå [DEBUG] Secret key elementi bulunamadƒ±!');
      }
      
      // Otomatik kod √ºret ve g√∂ster (kurulum i√ßin)
      startSetupAutoCode();
    }

    // QR kod olu≈üturuldu mu kontrol√º
    let qrCodeGenerated = false;
    let currentQRSecret = null;

    // QR kod otomatik olu≈ütur
    function generateQRCode() {
      console.log('üîç [DEBUG] generateQRCode() √ßaƒürƒ±ldƒ±');
      console.log('üîç [DEBUG] twoFactorSecret:', twoFactorSecret);
      
      if (!twoFactorSecret) {
        console.error('‚ùå [DEBUG] twoFactorSecret tanƒ±msƒ±z!');
        return;
      }
      
      // QR kod zaten olu≈üturulmu≈ü ve secret aynƒ±ysa tekrar olu≈üturma
      if (qrCodeGenerated && currentQRSecret === twoFactorSecret) {
        console.log('‚úÖ QR kod zaten olu≈üturulmu≈ü ve secret aynƒ±, tekrar olu≈üturulmuyor');
        return;
      }
      
      const otpAuthUrl = `otpauth://totp/Bambinifojo:Admin?secret=${twoFactorSecret}&issuer=Bambinifojo&algorithm=SHA1&digits=6&period=30`;
      console.log('üîç [DEBUG] OTP Auth URL:', otpAuthUrl);
      
      const qrContainer = document.getElementById('qrcode');
      console.log('üîç [DEBUG] QR Container:', qrContainer);
      
      if (!qrContainer) {
        console.error('‚ùå [DEBUG] QR container bulunamadƒ±!');
        console.error('‚ùå [DEBUG] Sayfada #qrcode ID\'li element var mƒ± kontrol et');
        return;
      }
      
      // QRCode k√ºt√ºphanesi kontrol√º
      const QRCodeLib = typeof QRCode !== 'undefined' ? QRCode : (typeof window.QRCode !== 'undefined' ? window.QRCode : null);
      
      if (!QRCodeLib) {
        console.error('‚ùå QRCode k√ºt√ºphanesi y√ºklenmemi≈ü!');
        qrContainer.innerHTML = `
          <div class="qr-error">
            <p>‚ùå QR kod k√ºt√ºphanesi y√ºklenemedi</p>
            <p>Manuel anahtarƒ± kullanarak ekleyebilirsiniz</p>
            <button onclick="location.reload()" style="margin-top: 10px; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">Sayfayƒ± Yenile</button>
          </div>
        `;
        return;
      }
      
      console.log('‚úÖ QRCode k√ºt√ºphanesi mevcut');
      
      // Loading g√∂ster
      qrContainer.innerHTML = `
        <div class="qr-loading">
          <div class="spinner-qr"></div>
          <p>QR kod olu≈üturuluyor...</p>
        </div>
      `;
      
      // QR kod boyutu - k√º√ß√ºlt√ºlm√º≈ü versiyon
      const qrSize = 140; // Sabit 140x140 boyut
      
      // QR kod olu≈ütur - toDataURL kullanarak (daha g√ºvenilir)
      try {
        // √ñnce bir canvas elementi olu≈ütur
        const canvas = document.createElement('canvas');
        canvas.id = 'qrcode-canvas';
        
        QRCodeLib.toCanvas(canvas, otpAuthUrl, {
          width: qrSize,
          margin: 2,
          color: {
            dark: '#1a1a1a',
            light: '#ffffff'
          },
          errorCorrectionLevel: 'M'
        }, (error) => {
          if (error) {
            console.error('‚ùå QR kod olu≈üturma hatasƒ±:', error);
            qrContainer.innerHTML = `
              <div class="qr-error">
                <p>‚ùå QR kod olu≈üturulamadƒ±</p>
                <p>Hata: ${error.message || error}</p>
                <p>Manuel anahtarƒ± kullanarak ekleyebilirsiniz</p>
              </div>
            `;
          } else {
            console.log('‚úÖ Canvas ba≈üarƒ±yla olu≈üturuldu');
            
            // Container'ƒ± temizle ve canvas'ƒ± ekle
            qrContainer.innerHTML = '';
            qrContainer.appendChild(canvas);
            
            // Canvas stilleri
            canvas.className = 'qr-canvas';
            canvas.style.display = 'block';
            canvas.style.margin = '0 auto';
            canvas.style.width = '140px';
            canvas.style.height = '140px';
            canvas.style.border = '3px solid #f0f0f0';
            canvas.style.borderRadius = '10px';
            canvas.style.padding = '8px';
            canvas.style.background = 'white';
            canvas.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.08)';
            
            // QR kod animasyonu
            canvas.style.opacity = '0';
            canvas.style.transform = 'scale(0.9)';
            canvas.style.transition = 'all 0.3s ease';
            
            setTimeout(() => {
              canvas.style.opacity = '1';
              canvas.style.transform = 'scale(1)';
              console.log('‚úÖ QR kod animasyonu tamamlandƒ±');
            }, 100);
            
            // QR kod tƒ±klanabilir yap (b√ºy√ºtme i√ßin)
            canvas.addEventListener('click', () => {
              const newWindow = window.open('', '_blank', 'width=800,height=900,scrollbars=no,resizable=yes');
              const qrDataUrl = canvas.toDataURL();
              newWindow.document.write(`
                <!DOCTYPE html>
                <html lang="tr">
                <head>
                  <meta charset="UTF-8">
                  <meta name="viewport" content="width=device-width, initial-scale=1.0">
                  <title>QR Kod - B√ºy√ºk G√∂r√ºn√ºm</title>
                  <style>
                    * {
                      margin: 0;
                      padding: 0;
                      box-sizing: border-box;
                    }
                    
                    body {
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                      min-height: 100vh;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      display: flex;
                      flex-direction: column;
                      align-items: center;
                      justify-content: center;
                      padding: 40px 20px;
                      position: relative;
                      overflow-x: hidden;
                    }
                    
                    body::before {
                      content: '';
                      position: fixed;
                      top: 0;
                      left: 0;
                      right: 0;
                      bottom: 0;
                      background: 
                        radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.3) 0%, transparent 50%);
                      pointer-events: none;
                      z-index: 0;
                    }
                    
                    .container {
                      position: relative;
                      z-index: 1;
                      background: rgba(255, 255, 255, 0.98);
                      backdrop-filter: blur(20px);
                      border-radius: 24px;
                      padding: 40px;
                      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                      border: 1px solid rgba(255, 255, 255, 0.3);
                      max-width: 600px;
                      width: 100%;
                      text-align: center;
                      animation: fadeInUp 0.5s ease;
                    }
                    
                    @keyframes fadeInUp {
                      from {
                        opacity: 0;
                        transform: translateY(30px);
                      }
                      to {
                        opacity: 1;
                        transform: translateY(0);
                      }
                    }
                    
                    .header {
                      margin-bottom: 30px;
                    }
                    
                    .header h1 {
                      font-size: 1.75rem;
                      font-weight: 700;
                      color: #1a1a1a;
                      margin-bottom: 8px;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      -webkit-background-clip: text;
                      -webkit-text-fill-color: transparent;
                      background-clip: text;
                    }
                    
                    .header p {
                      color: #6b7280;
                      font-size: 0.9375rem;
                      line-height: 1.6;
                    }
                    
                    .qr-wrapper {
                      background: white;
                      padding: 30px;
                      border-radius: 20px;
                      display: inline-block;
                      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
                      margin: 20px 0;
                      position: relative;
                      transition: transform 0.3s ease, box-shadow 0.3s ease;
                    }
                    
                    .qr-wrapper:hover {
                      transform: scale(1.02);
                      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
                    }
                    
                    .qr-wrapper::before {
                      content: '';
                      position: absolute;
                      top: -2px;
                      left: -2px;
                      right: -2px;
                      bottom: -2px;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      border-radius: 22px;
                      z-index: -1;
                      opacity: 0;
                      transition: opacity 0.3s ease;
                    }
                    
                    .qr-wrapper:hover::before {
                      opacity: 0.1;
                    }
                    
                    .qr-image {
                      max-width: 100%;
                      height: auto;
                      border-radius: 12px;
                      display: block;
                      margin: 0 auto;
                      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
                      transition: transform 0.3s ease;
                      cursor: pointer;
                    }
                    
                    .qr-wrapper:hover .qr-image {
                      transform: scale(1.05);
                    }
                    
                    .instructions {
                      margin-top: 30px;
                      padding: 20px;
                      background: #f9fafb;
                      border-radius: 12px;
                      border-left: 4px solid #667eea;
                    }
                    
                    .instructions h3 {
                      font-size: 1rem;
                      font-weight: 600;
                      color: #374151;
                      margin-bottom: 12px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      gap: 8px;
                    }
                    
                    .instructions ol {
                      text-align: left;
                      color: #6b7280;
                      font-size: 0.875rem;
                      line-height: 1.8;
                      padding-left: 20px;
                      max-width: 400px;
                      margin: 0 auto;
                    }
                    
                    .instructions li {
                      margin-bottom: 8px;
                    }
                    
                    .instructions li strong {
                      color: #667eea;
                      font-weight: 600;
                    }
                    
                    .close-btn {
                      margin-top: 30px;
                      padding: 12px 32px;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      border: none;
                      border-radius: 10px;
                      font-size: 0.9375rem;
                      font-weight: 600;
                      cursor: pointer;
                      transition: all 0.3s ease;
                      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                    }
                    
                    .close-btn:hover {
                      transform: translateY(-2px);
                      box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
                    }
                    
                    .close-btn:active {
                      transform: translateY(0);
                    }
                    
                    @media (max-width: 768px) {
                      .container {
                        padding: 30px 20px;
                        border-radius: 20px;
                      }
                      
                      .header h1 {
                        font-size: 1.5rem;
                      }
                      
                      .qr-wrapper {
                        padding: 20px;
                      }
                      
                      .instructions {
                        padding: 16px;
                      }
                      
                      .instructions ol {
                        font-size: 0.8125rem;
                      }
                    }
                  </style>
                </head>
                <body>
                  <div class="container">
                    <div class="header">
                      <h1>üì± QR Kod</h1>
                      <p>Google Authenticator ile tarayƒ±n</p>
                    </div>
                    
                    <div class="qr-wrapper">
                      <img src="${qrDataUrl}" alt="QR Kod" class="qr-image">
                    </div>
                    
                    <div class="instructions">
                      <h3>üìã Nasƒ±l Kullanƒ±lƒ±r?</h3>
                      <ol>
                        <li><strong>Google Authenticator</strong> uygulamasƒ±nƒ± a√ßƒ±n</li>
                        <li><strong>"+"</strong> butonuna tƒ±klayƒ±n</li>
                        <li><strong>"QR kod tarayarak ekle"</strong> se√ßeneƒüini se√ßin</li>
                        <li>Yukarƒ±daki QR kodu telefonunuzla tarayƒ±n</li>
                        <li>Hesap ba≈üarƒ±yla eklenecek! ‚úÖ</li>
                      </ol>
                    </div>
                    
                    <button class="close-btn" onclick="window.close()">‚úñÔ∏è Pencereyi Kapat</button>
                  </div>
                  
                  <script>
                    // ESC tu≈üu ile kapat
                    document.addEventListener('keydown', (e) => {
                      if (e.key === 'Escape') {
                        window.close();
                      }
                    });
                    
                    // QR kod tƒ±klanabilir yap (indirme i√ßin)
                    document.querySelector('.qr-image').addEventListener('click', function() {
                      const link = document.createElement('a');
                      link.download = 'qrcode-' + Date.now() + '.png';
                      link.href = this.src;
                      link.click();
                    });
                    
                    // QR kod √ºzerine gelince tooltip g√∂ster
                    const qrImage = document.querySelector('.qr-image');
                    qrImage.title = 'ƒ∞ndirmek i√ßin tƒ±klayƒ±n';
                  <\/script>
                </body>
                </html>
              `);
              newWindow.document.close();
            });
            
            canvas.style.cursor = 'pointer';
            canvas.title = 'B√ºy√ºk g√∂r√ºn√ºm i√ßin tƒ±klayƒ±n';
            
            // QR kod ba≈üarƒ±yla olu≈üturuldu i≈üaretle
            qrCodeGenerated = true;
            currentQRSecret = twoFactorSecret;
            
            console.log('‚úÖ QR kod ba≈üarƒ±yla olu≈üturuldu ve g√∂sterildi');
            console.log('‚úÖ QR kod sabit kalacak (secret deƒüi≈ümediƒüi s√ºrece tekrar olu≈üturulmayacak)');
          }
        });
      } catch (error) {
        console.error('‚ùå QR kod olu≈üturma hatasƒ±:', error);
        qrContainer.innerHTML = `
          <div class="qr-error">
            <p>‚ùå QR kod olu≈üturulamadƒ±</p>
            <p>Hata: ${error.message || error}</p>
            <p>Manuel anahtarƒ± kullanarak ekleyebilirsiniz</p>
          </div>
        `;
      }
    }

    // Kurulum i√ßin otomatik kod √ºret
    async function startSetupAutoCode() {
      if (!twoFactorSecret) return;
      
      const verifyInput = document.getElementById('verifyCode');
      if (!verifyInput) return;

      // ƒ∞lk kodu hemen √ºret ve g√∂ster
      updateSetupCode();
      
      // Her 30 saniyede bir g√ºncelle
      setInterval(() => {
        updateSetupCode();
      }, 30000);
    }

    // Kurulum kodunu g√ºncelle
    async function updateSetupCode() {
      if (!twoFactorSecret) return;
      
      try {
        const code = await generateTOTP(twoFactorSecret);
        const verifyInput = document.getElementById('verifyCode');
        const codeHint = document.getElementById('setupCodeHint');
        
        if (codeHint) {
          codeHint.textContent = `üí° ƒ∞pucu: G√ºncel kod ${code} (otomatik doldurmak i√ßin tƒ±klayƒ±n)`;
          codeHint.style.cursor = 'pointer';
          codeHint.onclick = () => {
            if (verifyInput) {
              verifyInput.value = code;
              verifyInput.focus();
            }
          };
        }
      } catch (error) {
        console.error('Kod √ºretme hatasƒ±:', error);
      }
    }

    // Login g√∂ster
    function showLogin() {
      console.log('üîç [DEBUG] showLogin() √ßaƒürƒ±ldƒ±');
      
      // √ñnce setup accordion'ƒ± kapat
      const setupAccordion = document.getElementById('setupAccordion');
      const setupBody = document.getElementById('setupBody');
      if (setupAccordion && setupBody && setupBody.classList.contains('open')) {
        console.log('üîç [DEBUG] Setup accordion kapatƒ±lƒ±yor...');
        closeAccordionItem(setupAccordion, setupBody);
      }
      
      // Kƒ±sa bir gecikme ile login accordion'ƒ± a√ß
      setTimeout(() => {
        const loginAccordion = document.getElementById('loginAccordion');
        const loginBody = document.getElementById('loginBody');
        console.log('üîç [DEBUG] Login Accordion:', loginAccordion);
        console.log('üîç [DEBUG] Login Body:', loginBody);
        
        if (loginAccordion && loginBody) {
          const loginHeader = loginAccordion.querySelector('.ac-header');
          console.log('üîç [DEBUG] Login Header:', loginHeader);
          openAccordionItem(loginAccordion, loginBody, loginHeader);
          console.log('‚úÖ [DEBUG] Login accordion a√ßƒ±ldƒ±');
          
          // Password input'a focus
          setTimeout(() => {
            const passwordInput = document.getElementById('password');
            if (passwordInput) {
              passwordInput.focus();
              console.log('‚úÖ [DEBUG] Password input focus edildi');
            }
          }, 600);
        } else {
          console.error('‚ùå [DEBUG] Login accordion elementleri bulunamadƒ±!');
        }
      }, 400);
    }

    // Accordion a√ßma/kapama fonksiyonu
    function initAccordion() {
      const headers = document.querySelectorAll('.ac-header');
      
      headers.forEach((header) => {
        header.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          
          const acItem = header.closest('.ac-item');
          const body = header.nextElementSibling;
          
          if (!body || !body.classList.contains('ac-body')) {
            return;
          }
          
          const wasOpen = body.classList.contains('open');
          
          // Diƒüer accordion'larƒ± kapat
          document.querySelectorAll('.ac-item').forEach((item) => {
            if (item !== acItem) {
              const otherBody = item.querySelector('.ac-body');
              if (otherBody && otherBody.classList.contains('open')) {
                closeAccordionItem(item, otherBody);
              }
            }
          });
          
          // Tƒ±klanan accordion'ƒ± a√ß/kapat
          if (wasOpen) {
            closeAccordionItem(acItem, body);
          } else {
            openAccordionItem(acItem, body, header);
          }
        });
      });
    }

    // Accordion a√ßma fonksiyonu
    function openAccordionItem(acItem, body, header) {
      // √ñnce padding'i ayarla ki scrollHeight doƒüru hesaplansƒ±n
      const isMobile = window.innerWidth <= 768;
      const padding = isMobile ? (window.innerWidth <= 480 ? '14px 10px' : '16px 12px') : '20px 16px';
      
      body.style.padding = padding;
      body.style.maxHeight = '0px';
      body.style.display = 'block';
      body.style.overflow = 'hidden';
      
      // scrollHeight'ƒ± al
      const scrollHeight = body.scrollHeight;
      
      // A√ßƒ±k duruma ge√ß
      body.classList.add('open');
      acItem.classList.add('active');
      
      // Animasyon i√ßin max-height ayarla
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          body.style.maxHeight = scrollHeight + 50 + 'px'; // Biraz ekstra alan
        });
      });
      
      // Animasyon bitince overflow'u d√ºzelt
      setTimeout(() => {
        body.style.overflow = '';
        body.style.maxHeight = '';
      }, 400);
      
      // Accordion a√ßƒ±ldƒ±ƒüƒ±nda smooth scroll yap
      setTimeout(() => {
        if (header) {
          const headerRect = header.getBoundingClientRect();
          const headerTop = headerRect.top + window.pageYOffset;
          const offset = 20;
          
          window.scrollTo({
            top: Math.max(0, headerTop - offset),
            behavior: 'smooth'
          });
        }
      }, 250);
    }

    // Accordion kapatma fonksiyonu
    function closeAccordionItem(acItem, body) {
      const currentHeight = body.scrollHeight;
      body.style.maxHeight = currentHeight + 'px';
      body.style.overflow = 'hidden';
      
      // Reflow i√ßin
      body.offsetHeight;
      
      requestAnimationFrame(() => {
        body.style.maxHeight = '0px';
        body.classList.remove('open');
        acItem.classList.remove('active');
        
        // Animasyon bitince temizle
        setTimeout(() => {
          if (!body.classList.contains('open')) {
            const isMobile = window.innerWidth <= 768;
            const padding = isMobile ? (window.innerWidth <= 480 ? '0 10px' : '0 12px') : '0 16px';
            body.style.padding = padding;
            body.style.maxHeight = '';
            body.style.overflow = '';
          }
        }, 400);
      });
    }

    // Setup'ƒ± atla
    function skipSetup() {
      if (confirm('2FA kurulumunu ≈üimdilik atlamak istediƒüinize emin misiniz? G√ºvenlik i√ßin √∂nerilmez.')) {
        twoFactorEnabled = false;
        localStorage.setItem('admin2FAEnabled', 'false');
        showLogin();
      }
    }

    // Setup doƒürula
    async function verifySetup() {
      const codeInput = document.getElementById('verifyCode');
      const code = codeInput.value.trim();
      
      if (!code || code.length !== 6 || !/^\d{6}$/.test(code)) {
        showNotification('‚ö†Ô∏è L√ºtfen 6 haneli ge√ßerli bir kod girin!', 'error');
        codeInput.classList.add('error');
        codeInput.focus();
        return;
      }

      codeInput.classList.remove('error');
      codeInput.disabled = true;
      
      try {
        const isValid = await verifyTOTP(twoFactorSecret, code);
        
        if (isValid) {
          // 2FA aktif et
          localStorage.setItem('admin2FASecret', twoFactorSecret);
          localStorage.setItem('admin2FAEnabled', 'true');
          twoFactorEnabled = true;
          
          console.log('‚úÖ 2FA doƒürulama ba≈üarƒ±lƒ±! Giri≈ü formuna ge√ßiliyor...');
          showNotification('‚úÖ 2FA ba≈üarƒ±yla kuruldu! Artƒ±k giri≈ü yaparken telefonunuzdaki kodu girmeniz gerekecek.', 'success');
          
          // Setup accordion'ƒ± kapat
          const setupAccordion = document.getElementById('setupAccordion');
          const setupBody = document.getElementById('setupBody');
          if (setupAccordion && setupBody) {
            closeAccordionItem(setupAccordion, setupBody);
          }
          
          setTimeout(() => {
            console.log('üîç showLogin() √ßaƒürƒ±lƒ±yor...');
            showLogin();
            
            // 2FA grup'u g√∂ster
            const twoFactorGroup = document.getElementById('twoFactorGroup');
            if (twoFactorGroup) {
              twoFactorGroup.classList.remove('hidden');
              console.log('‚úÖ 2FA grup g√∂sterildi');
            } else {
              console.error('‚ùå twoFactorGroup elementi bulunamadƒ±!');
            }
            
            // Otomatik kod √ºret
            if (typeof startAutoGenerateCode === 'function') {
              startAutoGenerateCode();
            }
          }, 1000);
        } else {
          showNotification('‚ùå Ge√ßersiz kod! L√ºtfen telefonunuzdaki g√ºncel kodu girin.', 'error');
          codeInput.value = '';
          codeInput.disabled = false;
          codeInput.focus();
          codeInput.classList.add('error');
        }
      } catch (error) {
        console.error('2FA doƒürulama hatasƒ±:', error);
        showNotification('‚ùå Bir hata olu≈ütu. L√ºtfen tekrar deneyin.', 'error');
        codeInput.disabled = false;
      }
    }

    // Secret key kopyala
    function copySecret() {
      const secretKeyElement = document.getElementById('secretKey');
      if (secretKeyElement) {
        const secret = secretKeyElement.value || secretKeyElement.textContent || secretKeyElement.innerText;
        navigator.clipboard.writeText(secret).then(() => {
          const btn = event?.target || document.querySelector('.copy-btn');
          const originalText = btn?.textContent || btn?.innerHTML;
          if (btn) {
            btn.textContent = '‚úì';
            btn.innerHTML = '‚úì';
            btn.style.background = '#2ecc71';
            setTimeout(() => {
              btn.textContent = originalText;
              btn.innerHTML = originalText;
              btn.style.background = '';
            }, 1500);
          }
        }).catch(() => {
          alert('Kopyalama ba≈üarƒ±sƒ±z!');
        });
      }
    }

    // Otomatik kod doldur
    async function autoFillCode() {
      if (!twoFactorSecret) {
        alert('2FA kurulumu yapƒ±lmamƒ±≈ü!');
        return;
      }

      try {
        const code = await generateTOTP(twoFactorSecret);
        const twoFactorInput = document.getElementById('twoFactorCode');
        if (twoFactorInput) {
          twoFactorInput.value = code;
          twoFactorInput.classList.remove('error');
          twoFactorInput.focus();
          
          // Ba≈üarƒ± animasyonu
          twoFactorInput.style.animation = 'pulse 0.5s';
          setTimeout(() => {
            twoFactorInput.style.animation = '';
          }, 500);
        }
      } catch (error) {
        console.error('Kod √ºretme hatasƒ±:', error);
        alert('Kod √ºretilirken bir hata olu≈ütu!');
      }
    }

    // ≈ûifre g√∂ster/gizle
    function togglePassword() {
      const passwordInput = document.getElementById('password');
      const eyeIcon = document.getElementById('eyeIcon');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        eyeIcon.innerHTML = `
          <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
          <line x1="1" y1="1" x2="23" y2="23"></line>
        `;
      } else {
        passwordInput.type = 'password';
        eyeIcon.innerHTML = `
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        `;
      }
    }

    // Giri≈ü i≈ülemi
    async function handleLogin(event) {
      event.preventDefault();
      
      const passwordInput = document.getElementById('password');
      const twoFactorInput = document.getElementById('twoFactorCode');
      const errorMessage = document.getElementById('errorMessage');
      const twoFactorError = document.getElementById('twoFactorError');
      const loginBtn = document.getElementById('loginBtn');
      let password = passwordInput.value.trim();
      let twoFactorCode = twoFactorInput ? twoFactorInput.value.trim() : '';
      
      // URL parametrelerinden ≈üifre ve 2FA kodu al (eƒüer varsa)
      const urlParams = new URLSearchParams(window.location.search);
      const urlPassword = urlParams.get('password');
      const urlTwoFactorCode = urlParams.get('twoFactorCode');
      
      if (urlPassword && !password) {
        password = urlPassword;
        if (passwordInput) {
          passwordInput.value = password;
        }
        console.log('üîó URL\'den ≈üifre alƒ±ndƒ±');
      }
      
      if (urlTwoFactorCode && !twoFactorCode) {
        twoFactorCode = urlTwoFactorCode;
        if (twoFactorInput) {
          twoFactorInput.value = twoFactorCode;
        }
        console.log('üîó URL\'den 2FA kodu alƒ±ndƒ±');
      }

      // Hata mesajlarƒ±nƒ± temizle
      errorMessage.textContent = '';
      twoFactorError.textContent = '';
      passwordInput.classList.remove('error');
      if (twoFactorInput) twoFactorInput.classList.remove('error');
      
      // Rate limiting kontrol√º
      const lockoutCheck = checkLoginLockout();
      if (lockoutCheck.locked) {
        errorMessage.textContent = `üîí ${lockoutCheck.message}`;
        passwordInput.classList.add('error');
        loginBtn.disabled = true;
        loginBtn.innerHTML = '<span>üîí Hesap Kilitli</span>';
        return;
      }

      // Form validasyonu
      if (!password || password.length === 0) {
        errorMessage.textContent = '‚ö†Ô∏è L√ºtfen ≈üifrenizi girin.';
        passwordInput.classList.add('error');
        passwordInput.focus();
        return;
      }

      if (password.length < 3) {
        errorMessage.textContent = '‚ö†Ô∏è ≈ûifre √ßok kƒ±sa.';
        passwordInput.classList.add('error');
        passwordInput.focus();
        return;
      }

      loginBtn.disabled = true;
      const loginBtnText = document.getElementById('loginBtnText');
      if (loginBtnText) {
        loginBtnText.textContent = '‚è≥ Kontrol ediliyor...';
      } else {
        loginBtn.innerHTML = '<span>‚è≥ Kontrol ediliyor...</span>';
      }

      // Eƒüer 2FA aktifse ve kod girilmemi≈üse, otomatik doldur
      if (twoFactorEnabled && twoFactorSecret && (!twoFactorCode || twoFactorCode.length !== 6)) {
        try {
          twoFactorCode = await generateTOTP(twoFactorSecret);
          if (twoFactorInput) {
            twoFactorInput.value = twoFactorCode;
          }
        } catch (error) {
          console.error('Otomatik kod √ºretme hatasƒ±:', error);
        }
      }

      try {
        // ≈ûifreyi hash'le
        const hashedPassword = await hashPassword(password);

        // Kullanƒ±cƒ± verilerini localStorage'dan y√ºkle
        let usersData = [];
        const saved = localStorage.getItem('adminUsers');
        if (saved) {
          try {
            usersData = JSON.parse(saved);
            console.log('üì¶ usersData y√ºklendi:', usersData.length, 'kullanƒ±cƒ±');
            if (usersData.length > 0) {
              console.log('üë§ Kullanƒ±cƒ±lar:', usersData.map(u => ({
                username: u.username,
                passwordHash: u.passwordHash ? u.passwordHash.substring(0, 10) + '...' : 'null'
              })));
            }
          } catch (e) {
            console.error('Kullanƒ±cƒ± verileri y√ºklenirken hata:', e);
            usersData = [];
          }
        } else {
          console.log('‚ö†Ô∏è localStorage\'da adminUsers bulunamadƒ±');
        }

        console.log('üîê Giri≈ü denemesi - ≈ûifre:', password.substring(0, 3) + '***');
        console.log('üîê Giri≈ü denemesi - Hash:', hashedPassword);
        console.log('üîê Varsayƒ±lan admin hash:', ADMIN_PASSWORD_HASH);
        console.log('üîê Hash e≈üle≈ümesi:', hashedPassword === ADMIN_PASSWORD_HASH);

        // ≈ûifre kontrol√º - √∂nce usersData i√ßinde ara, sonra varsayƒ±lan admin ≈üifresini kontrol et
        let authenticatedUser = null;
        
        // √ñnce kullanƒ±cƒ± listesinde ara
        authenticatedUser = usersData.find(user => user.passwordHash === hashedPassword);
        console.log('üîç usersData i√ßinde arama sonucu:', authenticatedUser ? '‚úÖ Bulundu' : '‚ùå Bulunamadƒ±');
        
        // Bulunamazsa ve usersData i√ßinde admin kullanƒ±cƒ±sƒ± yoksa, varsayƒ±lan admin ≈üifresini kontrol et
        // Eƒüer admin kullanƒ±cƒ±sƒ± zaten varsa, varsayƒ±lan ≈üifre ile giri≈ü yapƒ±ldƒ±ƒüƒ±nda ≈üifresini g√ºncelle
        if (!authenticatedUser) {
          const adminUserExists = usersData.find(user => user.username === 'admin');
          console.log('üîç Admin kullanƒ±cƒ±sƒ± mevcut mu:', adminUserExists ? '‚úÖ Evet' : '‚ùå Hayƒ±r');
          
          if (hashedPassword === ADMIN_PASSWORD_HASH) {
            // Varsayƒ±lan ≈üifre ile giri≈ü yapƒ±lƒ±yor
            if (!adminUserExists) {
              // Admin kullanƒ±cƒ±sƒ± yok - yeni admin kullanƒ±cƒ±sƒ± olu≈ütur
              authenticatedUser = {
                id: Date.now().toString(),
                username: 'admin',
                email: 'admin@example.com',
                passwordHash: ADMIN_PASSWORD_HASH,
                role: 'admin',
                createdAt: new Date().toISOString(),
                lastLogin: null
              };
              usersData.push(authenticatedUser);
              localStorage.setItem('adminUsers', JSON.stringify(usersData));
              console.log('‚úÖ Yeni admin kullanƒ±cƒ±sƒ± olu≈üturuldu (varsayƒ±lan ≈üifre ile)');
            } else {
              // Admin kullanƒ±cƒ±sƒ± var ama ≈üifre e≈üle≈ümiyor - varsayƒ±lan ≈üifre ile giri≈ü yapƒ±ldƒ±ƒüƒ±nda ≈üifresini g√ºncelle
              console.log('‚ö†Ô∏è Admin kullanƒ±cƒ±sƒ± mevcut ama ≈üifre e≈üle≈ümiyor - varsayƒ±lan ≈üifre ile g√ºncelleniyor');
              console.log('üîç Eski admin hash:', adminUserExists.passwordHash);
              console.log('üîç Yeni admin hash:', hashedPassword);
              
              // Admin kullanƒ±cƒ±sƒ±nƒ±n ≈üifresini varsayƒ±lan ≈üifre ile g√ºncelle
              adminUserExists.passwordHash = ADMIN_PASSWORD_HASH;
              usersData = usersData.map(user => 
                user.username === 'admin' ? adminUserExists : user
              );
              localStorage.setItem('adminUsers', JSON.stringify(usersData));
              authenticatedUser = adminUserExists;
              console.log('‚úÖ Admin kullanƒ±cƒ±sƒ± ≈üifresi varsayƒ±lan ≈üifre ile g√ºncellendi');
            }
          } else if (adminUserExists) {
            // Admin kullanƒ±cƒ±sƒ± var ama ≈üifre e≈üle≈ümiyor ve varsayƒ±lan ≈üifre deƒüil - hata
            console.log('‚ùå Admin kullanƒ±cƒ±sƒ± mevcut ama ≈üifre e≈üle≈ümiyor');
            console.log('üîç Mevcut admin hash:', adminUserExists.passwordHash);
            console.log('üîç Girilen hash:', hashedPassword);
            console.log('üí° ƒ∞pucu: Varsayƒ±lan ≈üifre "admin123" ile giri≈ü yaparak ≈üifrenizi sƒ±fƒ±rlayabilirsiniz');
          } else {
            console.log('‚ùå Varsayƒ±lan admin ≈üifresi ile e≈üle≈ümiyor ve admin kullanƒ±cƒ±sƒ± yok');
          }
        }

        // ≈ûifre kontrol√º ba≈üarƒ±sƒ±z
        if (!authenticatedUser) {
          console.error('‚ùå Kimlik doƒürulama ba≈üarƒ±sƒ±z:', {
            usersDataLength: usersData.length,
            hashedPassword: hashedPassword.substring(0, 10) + '...',
            adminPasswordHash: ADMIN_PASSWORD_HASH.substring(0, 10) + '...',
            hashMatch: hashedPassword === ADMIN_PASSWORD_HASH
          });
          const attemptResult = recordFailedLogin();
          
          if (attemptResult.locked) {
            errorMessage.textContent = `üîí ${attemptResult.message}`;
            passwordInput.classList.add('error');
            passwordInput.value = '';
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<span>üîí Hesap Kilitli</span>';
            passwordInput.style.animation = 'shake 0.5s';
            setTimeout(() => { passwordInput.style.animation = ''; }, 500);
            return;
          }

          const remaining = attemptResult.remaining || (MAX_LOGIN_ATTEMPTS - getLoginAttempts().count);
          errorMessage.textContent = `‚ùå Hatalƒ± ≈üifre! Kalan deneme hakkƒ±: ${remaining}`;
          passwordInput.classList.add('error');
          passwordInput.value = '';
          passwordInput.focus();
          const loginBtnText = document.getElementById('loginBtnText');
          if (loginBtnText) {
            loginBtnText.textContent = 'üîì Giri≈ü Yap';
          } else {
            loginBtn.innerHTML = '<span>üîì Giri≈ü Yap</span>';
          }
          loginBtn.disabled = false;
          passwordInput.style.animation = 'shake 0.5s';
          setTimeout(() => { passwordInput.style.animation = ''; }, 500);
          return;
        }

        // Ba≈üarƒ±lƒ± ≈üifre giri≈üi - deneme sayacƒ±nƒ± sƒ±fƒ±rla
        resetLoginAttempts();

        // 2FA kontrol√º (eƒüer aktifse)
        if (twoFactorEnabled && twoFactorSecret) {
          if (!twoFactorCode || twoFactorCode.length !== 6 || !/^\d{6}$/.test(twoFactorCode)) {
            twoFactorError.textContent = '‚ùå L√ºtfen 6 haneli doƒürulama kodunu girin!';
            if (twoFactorInput) {
              twoFactorInput.classList.add('error');
              twoFactorInput.focus();
            }
            const loginBtnText = document.getElementById('loginBtnText');
            if (loginBtnText) {
              loginBtnText.textContent = 'üîì Giri≈ü Yap';
            } else {
              loginBtn.innerHTML = '<span>üîì Giri≈ü Yap</span>';
            }
            loginBtn.disabled = false;
            return;
          }

          const isValid2FA = await verifyTOTP(twoFactorSecret, twoFactorCode);
          if (!isValid2FA) {
            twoFactorError.textContent = '‚ùå Ge√ßersiz doƒürulama kodu! L√ºtfen telefonunuzdaki g√ºncel kodu girin.';
            if (twoFactorInput) {
              twoFactorInput.classList.add('error');
              twoFactorInput.value = '';
              twoFactorInput.focus();
              twoFactorInput.style.animation = 'shake 0.5s';
              setTimeout(() => { twoFactorInput.style.animation = ''; }, 500);
            }
            const loginBtnText = document.getElementById('loginBtnText');
            if (loginBtnText) {
              loginBtnText.textContent = 'üîì Giri≈ü Yap';
            } else {
              loginBtn.innerHTML = '<span>üîì Giri≈ü Yap</span>';
            }
            loginBtn.disabled = false;
            return;
          }
        }

        // Ba≈üarƒ±lƒ± giri≈ü
        const sessionToken = btoa(Date.now().toString() + Math.random().toString() + Math.random().toString());
        sessionStorage.setItem('adminSession', sessionToken);
        sessionStorage.setItem('adminLoginTime', Date.now().toString());
        sessionStorage.setItem('adminLastActivity', Date.now().toString());
        sessionStorage.setItem('adminUsername', authenticatedUser.username);
        sessionStorage.setItem('adminRole', authenticatedUser.role);
        
        // Son giri≈ü zamanƒ±nƒ± g√ºncelle
        authenticatedUser.lastLogin = new Date().toISOString();
        usersData = usersData.map(user => 
          user.id === authenticatedUser.id ? authenticatedUser : user
        );
        localStorage.setItem('adminUsers', JSON.stringify(usersData));

        // Ba≈üarƒ± mesajƒ±
        const loginBtnText = document.getElementById('loginBtnText');
        if (loginBtnText) {
          loginBtnText.textContent = '‚úÖ Ba≈üarƒ±lƒ±! Y√∂nlendiriliyor...';
        } else {
          loginBtn.innerHTML = '<span>‚úÖ Ba≈üarƒ±lƒ±! Y√∂nlendiriliyor...</span>';
        }
        loginBtn.style.background = 'linear-gradient(135deg, #00c853 0%, #00a043 100%)';
        loginBtn.disabled = true;

        // Admin paneline y√∂nlendir
        setTimeout(() => {
          window.location.href = 'admin.html';
        }, 800);

      } catch (error) {
        console.error('Giri≈ü hatasƒ±:', error);
        errorMessage.textContent = '‚ùå Bir hata olu≈ütu. L√ºtfen tekrar deneyin.';
        const loginBtnText = document.getElementById('loginBtnText');
        if (loginBtnText) {
          loginBtnText.textContent = 'üîì Giri≈ü Yap';
        } else {
          loginBtn.innerHTML = '<span>üîì Giri≈ü Yap</span>';
        }
        loginBtn.disabled = false;
      }
    }

    // Animasyonlar
    const style = document.createElement('style');
    style.textContent = `
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
      }
      @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.02); }
      }
    `;
    document.head.appendChild(style);

    // Enter tu≈üu ile g√∂nder
    document.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const activeElement = document.activeElement;
        if (activeElement.id === 'password' || activeElement.id === 'twoFactorCode') {
          // Login formu i√ßin
          const loginForm = document.getElementById('loginForm');
          if (loginForm) {
            loginForm.dispatchEvent(new Event('submit'));
          }
        } else if (activeElement.id === 'verifyCode') {
          // Setup formu i√ßin
          verifySetup();
        }
      }
    });

    // Kod input'larƒ±nda sadece rakam
    document.addEventListener('input', (e) => {
      if (e.target.id === 'twoFactorCode' || e.target.id === 'verifyCode') {
        e.target.value = e.target.value.replace(/\D/g, '');
        e.target.classList.remove('error');
      }
    });

    // Notification g√∂ster
    function showNotification(message, type = 'info') {
      // Mevcut notification'larƒ± kaldƒ±r
      const existing = document.querySelectorAll('.notification');
      existing.forEach(n => n.remove());

      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      
      const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è';
      notification.innerHTML = `
        <span class="notification-icon">${icon}</span>
        <span class="notification-message">${message}</span>
        <button class="notification-close" onclick="this.parentElement.remove()">√ó</button>
      `;

      document.body.appendChild(notification);

      // 5 saniye sonra otomatik kapat
      setTimeout(() => {
        notification.classList.add('hiding');
        setTimeout(() => notification.remove(), 300);
      }, 5000);
    }

    // Sayfa y√ºklendiƒüinde rate limiting durumunu kontrol et
    window.addEventListener('DOMContentLoaded', () => {
      // Session timeout mesajƒ±nƒ± kontrol et
      const timeoutMessage = sessionStorage.getItem('sessionTimeoutMessage');
      if (timeoutMessage) {
        const errorMessage = document.getElementById('errorMessage');
        if (errorMessage) {
          errorMessage.textContent = `‚è±Ô∏è ${timeoutMessage}`;
          errorMessage.style.display = 'block';
          errorMessage.style.background = '#fef3c7';
          errorMessage.style.color = '#92400e';
          errorMessage.style.border = '1px solid #fbbf24';
          // Mesajƒ± g√∂sterdikten sonra temizle
          sessionStorage.removeItem('sessionTimeoutMessage');
        }
      }
      
      const lockoutCheck = checkLoginLockout();
      if (lockoutCheck.locked) {
        const errorMessage = document.getElementById('errorMessage');
        if (errorMessage) {
          errorMessage.textContent = `üîí ${lockoutCheck.message}`;
          const passwordInput = document.getElementById('password');
          if (passwordInput) {
            passwordInput.disabled = true;
            passwordInput.classList.add('error');
          }
          const loginBtn = document.getElementById('loginBtn');
          if (loginBtn) {
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<span>üîí Hesap Kilitli</span>';
          }
        }
      }
    });

    // Input'lara focus olduƒüunda hata durumunu temizle
    document.addEventListener('focusin', (e) => {
      if (e.target.tagName === 'INPUT') {
        e.target.classList.remove('error');
        const errorMsg = e.target.parentElement.querySelector('.error-message');
        if (errorMsg && errorMsg.textContent.trim() !== '') {
          setTimeout(() => {
            errorMsg.textContent = '';
          }, 300);
        }
      }
    });

    // Form submit √∂ncesi son validasyon
    document.getElementById('loginForm')?.addEventListener('submit', (e) => {
      const passwordInput = document.getElementById('password');
      if (!passwordInput || !passwordInput.value.trim()) {
        e.preventDefault();
        passwordInput?.focus();
        return false;
      }
    });

    // Global scope'a fonksiyonlarƒ± ekle (onclick handler'lar i√ßin)
    window.showSetup = showSetup;
    window.showLogin = showLogin;
    window.initAccordion = initAccordion;
    window.verifySetup = verifySetup;
    window.handleLogin = handleLogin;
    window.togglePassword = togglePassword;
    window.copySecret = copySecret;
    window.autoFillCode = autoFillCode;
    window.skipSetup = skipSetup;
  </script>
</body>
</html>

